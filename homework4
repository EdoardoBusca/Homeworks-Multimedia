<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Project</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: white;
            font-family: sans-serif;
        }
        
        #chartCanvas {
            border: 1px solid black;
            cursor: crosshair;
        }

        #controls {
            margin-bottom: 10px;
            padding: 10px;
            background: #eee;
            border: 1px solid #999;
            width: 900px;
        }

        #tooltip {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid black;
            padding: 5px;
            display: none;
            pointer-events: none;
            font-size: 12px;
        }

        #stats {
            margin-top: 10px;
            width: 900px;
            font-size: 14px;
            font-family: monospace;
            background-color: #f9f9f9;
            padding: 5px;
            border: 1px solid #ccc;
        }

        body.dark {
            background-color: #333;
            color: white;
        }
    </style>
</head>
<body>

    <div id="controls">
        <button onclick="toggleAnim()">Start/Stop</button>
        <button onclick="reset()">Reset</button>
        <label>Speed: <input type="range" min="100" max="2000" value="1000" onchange="changeSpeed(this.value)"></label>
        <label><input type="checkbox" onchange="toggleGrid(this)" checked> Grid</label>
        <label><input type="checkbox" onchange="toggleSmooth(this)"> Smooth</label>
        
        <select onchange="changeType(this.value)">
            <option value="line">Line Chart</option>
            <option value="area">Area Chart</option>
            <option value="bar">Bar Chart</option>
            <option value="scatter">Scatter Plot</option>
        </select>

        <button onclick="toggleTheme()">Dark Mode</button>
        <button onclick="saveImg()">Save Image</button>
    </div>

    <canvas id="chartCanvas" width="900" height="600"></canvas>
    
    <div id="tooltip"></div>

    <div id="stats">
        Current: <span id="currVal">0</span> | 
        Max: <span id="maxVal">0</span> | 
        Min: <span id="minVal">0</span> | 
        Avg: <span id="avgVal">0</span> | 
        Trend: <span id="trendVal">-</span>
    </div>

<script>
    let isPaused = false;
    let speed = 1000;
    let intervalId;
    let showGrid = true;
    let isSmooth = false;
    let chartType = 'line';
    let isDark = false;

    let data = [];
    let data2 = [];
    let data3 = [];

    window.onload = function() {
        let canvas = document.getElementById('chartCanvas');
        let context = canvas.getContext('2d');
        let tooltip = document.getElementById('tooltip');

        let width = canvas.width;
        let height = canvas.height;

        let xIncrement = 150;
        let yIncrement = 100;
        let valueIncrement = 20;
        let textOffset = 5;

        function drawVerticalLines()
        {
            if (showGrid == false) return;

            if (isDark) context.strokeStyle = '#555';
            else context.strokeStyle = 'gray';
            
            context.lineWidth = 1;
            
            for(let i = 0; i< width; i += xIncrement)
            {
                context.beginPath();
                context.moveTo(i, 0);
                context.lineTo(i, height);
                context.stroke();
            }
        }

        function drawHorizontalLines()
        {
            if (showGrid == false) return;

            if (isDark) context.strokeStyle = '#555';
            else context.strokeStyle = 'gray';

            context.lineWidth = 1;

            for (let i = 0; i < height; i += yIncrement)
            {
                context.beginPath();
                context.moveTo(0, i);
                context.lineTo(width, i);
                context.stroke();
            }
        }

        function drawChart(dataset, color)
        {
            context.strokeStyle = color;
            context.fillStyle = color;
            context.lineWidth = 5;

            context.beginPath();

            if (chartType == 'line' || chartType == 'area') {
                context.moveTo(0, height - dataset[0]);
                
                if (isSmooth) {
                    for (let i = 0; i < dataset.length - 1; i++) {
                        let x = i * valueIncrement;
                        let y = height - dataset[i];
                        let nextX = (i + 1) * valueIncrement;
                        let nextY = height - dataset[i+1];
                        let cpX = (x + nextX) / 2;
                        let cpY = (y + nextY) / 2;
                        context.quadraticCurveTo(x, y, cpX, cpY);
                    }
                } else {
                    for (let i = 1; i < dataset.length; i++) {
                        context.lineTo(i * valueIncrement, height - dataset[i]);
                    }
                }

                if (chartType == 'area') {
                    context.lineTo((dataset.length - 1) * valueIncrement, height);
                    context.lineTo(0, height);
                    context.closePath();
                    context.globalAlpha = 0.3;
                    context.fill();
                    context.globalAlpha = 1.0;
                } else {
                    context.stroke();
                }
            } 
            else if (chartType == 'bar') {
                for (let i = 0; i < dataset.length; i++) {
                    context.fillRect(i * valueIncrement, height - dataset[i], 10, dataset[i]);
                }
            }
            else if (chartType == 'scatter') {
                for (let i = 0; i < dataset.length; i++) {
                    context.beginPath();
                    context.arc(i * valueIncrement, height - dataset[i], 5, 0, 2 * Math.PI);
                    context.fill();
                }
            }
        }

        function drawVerticalLabels()
        {
            if (isDark) context.fillStyle = 'white';
            else context.fillStyle = 'black';

            for (let i = 0; i < height; i += yIncrement)
            {
                context.fillText(height - i, textOffset, i + 2 * textOffset);
            }
        }

        function drawHorizontalLabels()
        {
            if (isDark) context.fillStyle = 'white';
            else context.fillStyle = 'black';

            for (let i = 0; i < width; i+=xIncrement)
            {
                context.fillText(i, i + textOffset, height - textOffset);
            }
        }

        function generateRandomNumber()
        {
            return parseInt(Math.random() * height);
        }

        function generateData()
        {
            data = [];
            data2 = [];
            data3 = [];
            for (let i = 0; i <= width; i+= valueIncrement)
            {
                data.push(generateRandomNumber());
                data2.push(generateRandomNumber());
                data3.push(generateRandomNumber());
            }
        }

        function updateStats() {
            let max = 0;
            let min = 10000;
            let total = 0;
            let current = data[data.length-1];

            for(let i=0; i<data.length; i++) {
                if(data[i] > max) max = data[i];
                if(data[i] < min) min = data[i];
                total = total + data[i];
            }
            let avg = parseInt(total / data.length);

            let trend = "-";
            if (data.length > 1) {
                if (data[data.length-1] > data[data.length-2]) trend = "Rising ↗";
                else trend = "Falling ↘";
            }

            document.getElementById('currVal').innerText = current;
            document.getElementById('maxVal').innerText = max;
            document.getElementById('minVal').innerText = min;
            document.getElementById('avgVal').innerText = avg;
            document.getElementById('trendVal').innerText = trend;
        }

        function draw()
        {
            if (isDark) {
                context.fillStyle = '#222';
                context.fillRect(0, 0, width, height);
            } else {
                context.clearRect(0, 0, width, height);
            }

            drawVerticalLines();
            drawHorizontalLines();
            drawVerticalLabels();
            drawHorizontalLabels();
            
            drawChart(data, 'green');
            drawChart(data2, 'blue');
            drawChart(data3, 'red');
            
            updateStats();
        }

        function generateNewValue()
        {
            data.push(generateRandomNumber());
            data.shift();

            data2.push(generateRandomNumber());
            data2.shift();
            
            data3.push(generateRandomNumber());
            data3.shift();
        }

        canvas.onmousemove = function(e) {
            let rect = canvas.getBoundingClientRect();
            let x = e.clientX - rect.left;
            let index = parseInt(x / valueIncrement);

            if (index >= 0 && index < data.length) {
                tooltip.style.display = 'block';
                tooltip.style.left = (e.pageX + 10) + 'px';
                tooltip.style.top = (e.pageY + 10) + 'px';
                tooltip.innerHTML = "<strong>Time: " + index + "</strong><br>" + 
                                    "<span style='color:green'>Green: " + data[index] + "</span><br>" + 
                                    "<span style='color:blue'>Blue: " + data2[index] + "</span><br>" + 
                                    "<span style='color:red'>Red: " + data3[index] + "</span>";
            } else {
                tooltip.style.display = 'none';
            }
        }
        
        canvas.onmouseout = function() {
            tooltip.style.display = 'none';
        }

        intervalId = setInterval(function() {
            if (isPaused == false) {
                generateNewValue();
                draw();
            }
        }, speed);

        generateData();
        draw();

        window.toggleAnim = function() { isPaused = !isPaused; }
        window.reset = function() { generateData(); draw(); }
        
        window.changeSpeed = function(val) {
            speed = val;
            clearInterval(intervalId);
            intervalId = setInterval(function() {
                if (isPaused == false) { generateNewValue(); draw(); }
            }, speed);
        }
        
        window.toggleGrid = function(cb) { showGrid = cb.checked; draw(); }
        window.toggleSmooth = function(cb) { isSmooth = cb.checked; draw(); }
        window.changeType = function(val) { chartType = val; draw(); }
        
        window.toggleTheme = function() {
            isDark = !isDark;
            if (isDark) document.body.classList.add('dark');
            else document.body.classList.remove('dark');
            draw();
        }
        
        window.saveImg = function() {
            let link = document.createElement('a');
            link.download = 'chart.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    }
</script>
</body>
</html>
